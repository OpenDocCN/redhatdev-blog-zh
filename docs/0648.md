# 提高集装箱安全性的 3 个步骤

> 原文:[https://developers . red hat . com/blog/2019/10/21/3-改善容器安全性的步骤](https://developers.redhat.com/blog/2019/10/21/3-steps-toward-improving-container-security)

随着开发人员越来越多地使用容器，保护容器变得越来越重要。在这份报告中，Gartner 将[容器安全](https://www.csoonline.com/article/3268922/why-securing-containers-and-microservices-is-a-challenge.html)列为今年 T2 十大关注之一，这并不奇怪，因为它们在生产轻量级和可重用代码以及降低应用程序开发成本方面很受欢迎。

在本文中，我将研究容器安全性涉及的三个基本步骤:保护构建环境、保护底层容器主机以及保护每个容器中运行的实际内容。要成功掌握容器安全性，意味着要注意所有这三个要素。

如果退后一步看，容器安全性与普通的应用程序安全性并没有什么不同。如果你把上面一段中合适的词替换掉，你可以在 10 年、20 年甚至 30 年前写这篇文章，并做一些其他的修改。但是容器确实有一些值得强调的奇怪和新的变化。首先，我建议[你听一下 Red Hat 的 Dan Walsh 关于一般集装箱安全考虑的演讲录音](https://developers.redhat.com/blog/2018/12/19/security-considerations-for-container-runtimes/)。

## 1.保护构建环境

让我们从保护构建环境本身开始。与任何应用程序开发过程一样，在项目开始时添加安全性是最有意义的，而不是在编写了大部分代码之后才添加一些东西。从一开始就使用正确的方法可以提高程序员的效率，并使应用程序开发过程更加顺利。

第一个组件有三个独立的部分:首先，你需要**理解你的 DevOps 工作流程。**这包括你如何构造你的容器，从哪里获得它们的代码，以及底层代码改变的频率。容器的一个吸引人之处是它们的“即时”特性，在这里你可以从各种在线资源中提取代码。您如何知道这些代码已经被适当地审查以供一般使用，然后您如何知道您自己的特定 DevOps 过程没有引入一些将打开后门的特定的极限情况？这应该是您在这些工作流程练习中的重点。

确保工作流安全的一部分是能够使用发现工具(例如，Red Hat 的 Quay.io)来确保容器得到安全管理和适当扩展。该工具自动扫描每个容器的安全漏洞。[这篇文章将带你了解如何使用 Quay](https://developers.redhat.com/blog/2019/06/26/using-quay-io-to-find-vulnerabilities-in-your-container-images/) 以及会发生什么。

第二种情况涉及到**检查用户和实际应用本身的访问规则和权限**。如果你追踪安全漏洞，你会意识到这只是普通 SaaS 应用中的一个常见主题。有多少不安全的 web 服务存储容器由于没有实际的密码或没有被锁定的“全部访问”权限而被泄露到网上？太多了，这在容器世界中可能是真的，在那里应用程序的数量可能是压倒性的。

一个必须做的事情是**检查适当访问控制**所需的粒度级别，包括为您的应用和最终用户提供适当的安全级别。您知道代码的哪些部分具有根级别的访问权限吗？哪些部分**实际上需要**根级访问呢？不同的答案可能意味着一个或多或少安全的容器，最佳答案是尽可能少，接近零。如果你对普通用户和应用程序访问控制使用 LDAP，你[可能想回顾一下这篇文章中关于如何验证 LDAP 参数](https://developers.redhat.com/blog/2019/08/02/how-to-configure-ldap-user-authentication-and-rbac-in-red-hat-openshift-3-11/)和在 [Red Hat OpenShift](https://developers.redhat.com/openshift/) 中启用 LDAP 认证的建议。

最后，通过强化您的构建环境，有了使用运行时保护的能力。像普通应用程序的工具一样，这些工具中的一些专注于静态扫描，而另一些使用您选择的开发环境提供持续集成。考虑到容器代码的动态特性，连续方法更好，当您必须执行应用程序审计时，它也可以节省大量时间。一个好的运行时保护容器工具应该能够标记异常行为，补救潜在威胁，并隔离特殊事件以供进一步的取证分析。

## 2.保护底层容器主机

一旦构建环境安全了，下一步就是强化运行容器服务器和服务的底层主机。仔细看看您的容器提供商在安全性方面提供了什么。这些选项可能是原生 Linux 容器和 OpenShift 安全特性的一部分，例如防止滥用资源的策略、设置访问控制组，以及确保在任何地方都删除 root 访问权限，或者至少在不真正需要的地方删除。许多都是人们熟悉的安全实践，是虚拟机世界的一部分，所以它们不应该令人惊讶。它们只是与您在接触容器之前可能已经习惯的环境略有不同。例如，一个推荐的最佳实践是只运行带有只读图像的容器。

## 3.保护每个容器中运行的内容

最后一步是保护容器内的内容。这与保护普通应用程序并没有什么不同，但确实有一些奇怪之处。例如，您应该限制在您的容器中运行的各种 Linux OS 特性。Linux 有一个通用的操作系统级安全筛选工具，叫做 [seccomp，也值得回顾一下](https://lwn.net/Articles/656307/)。您还应该实施图像源完整性保护，这样您就可以跟踪容器中哪些内容发生了变化，并知道谁对此负责。

我意识到这是一项繁重的工作，而且这项工作还涉及到熟悉多种工具、多种应用程序、容器和操作系统结构。一个好的起点是研究众多的第三方容器安全工具。其中一些可以从开源供应商那里获得，其他的可以从商业供应商那里获得，这些供应商也可以在您的安全之旅中提供帮助。

*Last updated: July 1, 2020*