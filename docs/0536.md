# 与 GDB Buildbot 的持续集成

> 原文：<https://developers.redhat.com/blog/2020/02/17/continuous-integration-with-gdb-buildbot>

持续集成是最近的热门话题，GNU 项目调试器也紧跟潮流。除了调试器，还有谁能更好地充当跟踪和消除 bug 的角色模型呢？

GDB 建造机器人始于 2014 年的一个宠物项目，但现在是开发过程中不可或缺的一部分。它提供了一个基础设施来测试推送到官方存储库的新提交，以及一个服务(我们称之为 *try builds* )供开发人员提交他们提议的变更。在这篇文章中，我分享了我们的 [Buildbot](https://buildbot.net/) 实例的故事，就功能而言，我们现在所处的位置，以及未来的计划(和挑战)。

## 连续累计

首先:定义什么是*持续集成*很重要。据[维基百科](https://en.wikipedia.org/wiki/Continuous_integration):

> *[...持续集成(CI)是一天几次将所有开发人员的工作副本合并到一个共享的中的实践。[...]*

不是很清楚。换句话说，CI 是一个不断编译和测试项目代码库的自动化系统。CI 系统测试项目中的每一个提交是很常见的。这样，如果出现问题，开发人员能够更快地解决问题。通常，CI 测试在提交实际集成到代码库之前*完成。然而，GDB 项目使用了一种不同的方法:CI 是在代码被推送到上游*之后*执行的。*

## 从前

回到 2014 年，GDB 项目没有持续集成工具。开发人员友好地提供测试套件结果，并报告代码中的回归，通常使用他们自己的机器。然而，这些开发人员资源有限，无法同时测试各种架构。编译失败通常不会出现在没有广泛使用的系统中。最终，这个问题在 GDB 发布后的发布过程中造成了延迟和烦恼。

为了解决这个问题，GDB 建造机器人应运而生。最初只支持运行在 Intel/AMD 32 和 64 位上的 GNU/Linux，但是社区很快开始支持其他机器和架构。初始设置使用公共配置标志编译和测试代码，但是开发人员仍然需要查阅网页才能知道结果。

随着时间的推移，该实例得到了改进，并添加了新的功能，包括每当提交导致编译失败时的电子邮件通知，以及向包含每次 testsuite 运行结果的 [gdb-testers](https://sourceware.org/ml/gdb-testers/) 邮件列表发送的电子邮件通知。

也许最有用的特性之一是 *try build* 系统。

## 并为所有人尝试构建

社区开始注意到拥有 CI 系统的好处，但是我们想要更多。Buildbot 甚至可以在补丁被推送到存储库中的*主*分支之前测试补丁，这对开发人员来说是一个有用的工具。例如，开发人员可能无法访问大量不同的架构来测试补丁。出于这个原因，我们在 Buildbot 上启用了 *try build* 特性。对试用版的访问仅限于拥有对资源库的*推送*访问权限的 GDB 开发人员；他们中的一些人已经每天使用这项服务。

当开发人员向 try build 服务提交补丁时，Buildbot 将构建、测试并向开发人员发送包含结果的电子邮件。这种设置是快速了解变更是否破坏了项目中某些内容的便捷方式。

## 挑战:薛定谔测试

也许我们现在面临的最大挑战是我们所谓的 *racy* (或*非确定性* ) *测试*。这些测试能否通过取决于几个因素，比如代码中的竞争条件、系统负载和并行性。作为一个社区，我们已经解决这些问题很长时间了。尽管我们已经取得了很大进展，但前面的路还很长。这些测试导致 GDB Buildbot 结果不可预测，最终破坏了开发人员对 CI 系统的信任。

另一个挑战是很难为那些没有被广泛使用的体系结构和系统获得机器。在撰写本文时，我们已经为 Intel/AMD 32 位和 64 位、S/390x、SPARC v9、AArch64 和 ARMhf 构建了机器。这些机器正在测试 GNU/Linux、FreeBSD 和其他操作系统。

最后，但同样重要的是，我们可以提及一个事实，即基础架构仅由一个人维护(真正属于您的人)。这种设置一直都是这样的，但是如果我忙于更紧迫的工作，这就会成为一个问题。

## 看地平线

事实证明，GDB Buildbot 实例是社区基础设施的重要组成部分。一旦 racy 测试的问题得到解决，我们将能够:

*   将带有测试结果的电子邮件通知直接发送到我们的主邮件列表， [gdb-patches](https://sourceware.org/ml/gdb-patches/) 。
*   将带有测试结果的电子邮件通知直接发送给提交作者。
*   在提交被集成到我们的代码库之前，实现一种执行 CI 测试的方法。

另一个正在开发的有趣项目是[本生灯](https://github.com/serhei/bunsen)。它的目的是提供一种更好的方法来分析由 GDB 使用的 DejaGNU 框架生成的测试套件结果。事实上，本生是通过 GDB Buildbot 自己的测试结果进行测试的。一旦 Bunsen 被认为足够成熟，这个工具肯定会被集成到我们的实例中。

## 结论

GDB Buildbot 是一个正在进行的努力，以提高代码质量，帮助开发人员花更少的时间寻找回归。有许多增强服务的可能性和许多新功能的想法。如果你正在寻找一种为 GDB 做贡献的方式，帮助 CI 系统肯定是一个好的开始。

*Last updated: June 29, 2020*