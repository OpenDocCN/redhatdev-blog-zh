# /etc/nsswitch.conf 的非复杂性

> 原文：<https://developers.redhat.com/blog/2018/11/26/etc-nsswitch-conf-non-complexity>

在大多数基于 glibc 的操作系统中，有一个文件/etc/nsswitch.conf，大多数人忽略它，很少有人理解它，但所有人通常都依赖它。这个文件决定了系统在哪里可以找到诸如主机名、密码和协议号之类的东西。你的公司使用 LDAP 吗？NIS？普通文件？nsswitch 文件(它代表“名称服务交换机”)告诉系统对每种类型的名称查找使用什么服务。

以下是/etc/nsswitch.conf 文件示例的一个片段:

```
passwd:   files nis
group:    files nis

hosts:    files dns myhostname

```

在本例中，用户信息(passwd 和组服务)首先来自“文件”(如/etc/passwd 或/etc/group)，如果在那里没有找到条目，将使用对 NIS 服务器(在别处配置)的查询。主机信息首先来自/etc/hosts(文件)，然后是 dns 服务器(DNS)，如果这两者都不起作用，至少可以使用“myhostname ”,这样本地机器就有了*某个*名称。

非复杂性来自“如果那不起作用”规则。当多个服务被列出时，它们被依次尝试，并且一个服务要么成功要么失败。如果失败，则尝试下一个，以此类推。有一种方法可以检查其他一些情况(条目未找到，或服务暂时不可用)，但根据这些情况，你唯一能做的就是要么尝试下一个服务，要么不要。

这种简单性已经导致了一个缺点，即当既有本地组又有全局组(例如 LDAP)时，对用户组的处理。你不会想在这两者之间做出选择，你宁愿被允许加入这两组群体的联合。nsswitch.conf 语法对此有一个特例:

```
groups:   files [SUCCESS=merge] ldap

```

通常，成功的查找会终止查找并返回一个值。这个特例表明，即使“文件”查找有效，也要尝试“ldap”服务*和*，并将两个组列表合并在一起。最近出现了另一个特例，systemd 为本地机器提供了一些服务。这里的问题是“本地机器”——它不提供全局服务，但是 nsswitch 语法不允许“委托”。如果 systemd 服务没有找到记录，那“没有找到”是权威的吗？

如果您想为不同的域提供不同的服务呢？目前，您唯一的选择是配置一个本地 DNS 服务器，该服务器具有域委派的所有逻辑，并参考 nsswitch.conf 中的内容。这仅在 DNS 服务器正在运行时才起作用，这可能不是机器首次启动时的情况，并且当您更改网络(wifi？vpn？).

那么这篇文章的重点是什么呢？我一直在思考这个文件的简单性，并想知道它的未来可能包含什么。如果您可以基于搜索字符串的模式匹配来选择服务，会怎么样？如果它可以测试外部条件，如一天中的时间，或 VPN，会怎么样？如果您的公司安全规则要求更具确定性的故障模式，会怎么样？我并不是建议 nsswitch.conf 成为某种完整的编程语言(有人知道吗？；)但是如果它在现有的基础上再有一些决策语法，它会是什么样子呢？它能解决什么样的问题？*你*有什么问题可以通过更灵活的 nsswitch.conf 解决吗？如果有，就在下面的评论里分享吧！